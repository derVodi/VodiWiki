<!DOCTYPE html>
<html>
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "VodiWiki", major: 1, minor: 0, revision: 11};
//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="Copyright (c) Mark Vodicka 2016-2020 (www.vodi.de)
Copyright (c) TiddlyWiki created by Jeremy Ruston 2004-2007 (jeremy [at] osmosoft [dot] com)
Copyright (c) UnaMesa Association 2007-2012
Copyright (c) abego Software GmbH, 2005-2012 (www.abego-software.de)

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met: Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution. Neither the name of Mark Vodicka, Jeremy Ruston, the UnaMesa Association, abego Software nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITEDTO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE." />
<!--PRE-HEAD-START-->
<!--PRE-HEAD-END-->
<title> VodiWiki </title>
<style id="styleArea" type="text/css">

/* Anatomy */

body {margin: 0; padding: 0;}
html, body, #contentWrapper, #displayArea, #tiddlerDisplay {height: 100%; overflow:hidden;}
#backstageTabBar {position:relative; padding: 0 0.3em; z-index:900;}
.backstageTabHead {display: inline-block; margin: 1px 1px 0 1px; padding: 0.3em 1em; border-radius: 4px 4px 0 0;}
#backstagePanel {display:none; z-index:900; box-sizing:border-box; max-width: calc(100% - 4em); max-height:calc(100% - 3em); margin-left:4.9em; padding:1em; position:absolute; overflow: auto;}
.backstagePanelBody {position:relative;}

#navigationArea {float: left; min-width: 1em; width: auto; height:100%; position:relative; padding: 9px 1px 0 0;}
#navigationCollapser {position:absolute; top: 5px; right: 0; z-index:200;}
#navigationPanel {position:static; height:100%;}

#navAndSearch {margin-bottom: 0.3em;}
#breadcrumbsBox {border: 1px inset grey; padding: 0 0.3em; line-height: 1.3em; }
#navToolbar, #search, #navButtons, #breadcrumbsBox {display: table-cell;}
#navToolbar, #breadcrumbsBox {width: 100%;}
#search, #breadcrumbsBox {white-space: nowrap;}
.searchField {margin-left: 1em;}
.searchField, #search .button {display: inline-block; box-sizing: border-box; height: 1.7em;}

.articleContentContainer {position:relative; padding-top: 0.5em; padding-bottom: 2em;}
table {border-collapse: collapse;}
table td {vertical-align: top;}
.articleContentContainer table, table.twtable {margin: 1pt 0;}
.articleContentContainer th, .articleContentContainer td, .articleContentContainer tr, .articleContentContainer caption, .twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
.toolbar {text-align:right; font-size:.9em;}
#displayArea {padding-top: 3px}
#pageWrapper {position:relative; height:100%;}
#tiddlerDisplay {position:relative;}
.articleView {bottom: 3em; left: 0; overflow: auto; position: absolute; right: 0; top: 0; padding: 6pt 8pt 0;}

#saveTest {display:none;}

#messageArea {z-index:2000; display:none; position:absolute; top:0; right:0;}
#messageArea {border:1px solid #db4; background:#fe8;}
#messageArea {margin:0.5em; padding:0 0.5em 0.5em 0.5em; }
#messageArea .button {display:block; text-align:right; font-size:0.7em;}

#sidebar {position: static; width:auto; float: right; padding:26px 0;}

#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#internalArticles {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}

.fieldsetFix {border:0; padding:0; margin:1px 0px;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0; font-size:.9em;}

/* Text */

body, #navigationPanel, .articleContentContainer, .editor, h3, h4 {font-size: 11.5pt;}
h5, #search {font-size: 10pt;}
.licenseText, .yourSearchResult .summary .chkBoxLabel {font-size: 8pt;}
.licenseText {display: inline-block; line-height: 1em; width: 51em; text-align: justify;}
body, .articleContentContainer, .editor, h3, h4, h5, h6 {font-family: calibri, tahoma, helvetica; line-height: 1.2em;}

h1, h2, h3, h4, h5, h6 {margin: 0; border: 0;}
h1 {font-size: 14pt; padding: 2pt 0 2pt 0;}
h2 {font-size:13pt;padding: 1pt 0 1pt 0;}
h3, h4, h5, h6 {padding: 1pt 0 0;}
h4 {font-style:italic;}
h5 {font-weight:normal;}
h6 {display:none;}
a {text-decoration: none;}
a img {border: 0;}
pre, code {font-family: consolas, lucida console, mono,courier; font-size: 10pt; line-height: 10pt; margin: 0;}
pre {padding: 4pt;}
code {white-space: nowrap;}
textarea, .articleContentContainer pre {tab-size: 2; -moz-tab-size: 2}
.twtable thead td {font-weight: bold;}
#navigationPanel, #sidebarContent {line-height: 1.3em;}
.articleTreePanel {line-height: 1.4em;}
.title {font-size: 18pt; font-weight: normal;}
#tiddlerDisplay .title {margin:-0.5em 0 12pt 0;}
table.listView {font-size: 0.85em;}
.externalLink {text-decoration: underline;}
.tiddlyLinkNonExisting, .missing .articleContentContainer, .missing .title {font-style:italic;}
.backstageTabHead {font-weight: bold;}

/* Layout Elements */

ul, ol {padding: 0 0 0 12pt; margin: 0 0 0 6pt;}
hr {height: 1px; border: 0; background-color: grey;}
.listBreak {border-bottom: 1px solid;}
table.twtable, .twtable td, .twtable thead td, .twtable th, .wizard, .popup, .yourSearchResult {border: 1px solid;}
table.listView th, table.listView td, table.listView tr {padding: 0 3px 0 3px;}
.dualColorTable {display: inline-block;}
.TODO {color:whitesmoke;background-color: black;	padding: 0.3em 0.7em 0.3em 2.3em;	border-radius: 5px;	display: inline-block;	text-indent: -1.8em;}
.TODO::before {content: '[TODO] ';font-size: 0.7em;vertical-align: top;color:aqua;}
.notice {background-color: khaki; padding: 0.3em 0.7em 0.3em 2.3em;	border-radius: 5px;	display: inline-block;	text-indent: -1.8em;}
.notice::before {content: '🛈 ';font-size: 1.3em;vertical-align: bottom;}
blockquote {line-height: 1.5em;	padding: 0.1em 0.5em 0.3em 1.7em;	margin: 0;	box-shadow: inset 0 0 0.5em gray;	border: 0;position:relative;}
blockquote::before {position:absolute;top:0.3em;left:0.2em;content:'\275D'; font-size: 2em; color:lightgrey;}

/* Interactivity */

.button {border-width:1px; border-style: solid; border-radius: 3px; padding: 0.1em 0.5em; font-weight: bold;}
.buttonWithIcon {display: block; position: relative; padding-left: 1.75em; margin-bottom: 0.5em;}
.buttonWithIcon *:first-child {position: absolute; left: 0;}

.listView input:not([type=checkbox]) {width:  11em; border:0;} /* These are nested in table cells */
.branch .button {position: absolute; left: -1em; padding: 0;}
.tab {margin: 0 1pt 0 0; padding: 2px 0.6em; border-radius: 0.4em 0.4em 0 0;}
.tabContents {padding: 0.3em;}
.sideBarTabSet .tabContents li {list-style:none;}
.tabContents li.listLink {margin-left:.75em;}
.tabContents {position: relative; height: 100%; height: calc(100% - 49px); overflow-y: scroll; padding-right: 0.8em;}

#navigationPanel .tabsetWrapper {height:100%; position:relative;}
#navigationPanel .button {display: block; border: 0;}
#navigationPanel li {list-style: none;}
.articleTreePanel > .nodesWrapper {margin-left: 0;}
.nodesWrapper {margin-left: 1em;}
.branch {position: relative;}
.branch a {display: block;}
.branch, .leaf {display: block; margin-left: 1em;}
.branch .tiddlyLink, .leaf {padding-left: 0.3em;}
.articleTreeButtons {display: block; margin-top: 0.5em;}

#backstageCloak {display:none; z-index:500; position:absolute; width:100%; height:100%; background: black; opacity:0.6; filter:alpha(opacity=60);}

#backstageButton {position:absolute; z-index:1000; top:0; right:0; font-size:0.7em;}
#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}
#backstageShow {color: transparent;}

#sidebarCollapser {text-align:right;}
#sidebarTabs .tabContents {overflow:hidden;}

.popup {position:absolute; z-index:1000; font-size:.9em; padding:0; list-style:none; margin:0;}

.inputDialogPanel{left: 0;margin: auto; padding: 0.3em 0.7em 0.7em; position: absolute; right: 0; top: 50%; transform: translateY(-50%); width: 640px; z-index: 1000;}
.inputDialogPanel h1, .inputDialogPanel input {margin-bottom: 0.3em;}
.inputDialogPanel input {display:block; width:99%;}
.inputDialogPanel-buttonsPanel {text-align: right;margin-top: 1em;}
.inputDialogPanel-buttonsPanel button {min-width: 75px;margin: 0 0.3em;}

.wizard {box-sizing: border-box; height: 100%; padding: 2.75em 1em 0.3em 1em} /* Top: Leave space for title */
.wizard .title {position:absolute; top: 0.4em;} /* Float title, otherwise it would consume vertical space and break height calculation of nested divs */
.wizard h1 {margin-bottom: 0.5em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0; text-align: right;}
.wizardFooter .status {text-align: left; margin-bottom: 0.5em; }
.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

.yourSearchResult {position: absolute; width: 800px; padding: 0.2em; list-style: none; margin: 0; background: lightyellow;}
.yourSearchResult .summary {border-bottom-width: thin; border-bottom-style: solid; padding-bottom: 4px;}
.yourSearchItem {margin-top: 2px;}
.yourSearchNumber {color: #808080;} /* todo: tree shake */
.yourSearchTags {color: #008000;}
.yourSearchText {color: #808080; margin-bottom: 6px;}
.yourSearchFooter {margin-top: 8px; border-top-width: thin; border-top-style: solid; border-top-color: #999999;}
.yourSearchFooter a:hover{background: none; color: none;}
.yourSearchNaviBar a {font-size: 16px; margin-left: 4px; margin-right: 4px; color: black; text-decoration: underline;}
.yourSearchNaviBar a:hover {background-color: none;}
.yourSearchNaviBar .prev {font-weight: bold; color: blue;}
.yourSearchNaviBar .currentPage {color: red; font-weight: bold; text-decoration: none;}
.yourSearchNaviBar .next {font-weight: bold; color: blue;}

/* Colors.Foregrounds (sorting: getting lighter) */

.twtable thead td, .backstageTabHead:hover, #backstageShow, a.backstageSelTab {color: black;}
.anchor, .anchor:hover, .title, .inputDialogPanel {color: black;}
.button, .button:hover, .button a, #breadcrumbsBox a {color: darkblue;}

a, a:hover {color:blue;}

#navigationPanel .button, .editorFooter {color: darkgray;}
.yourSearchResult .summary {border-color: darkgray;}
table.twtable, .twtable td, .twtable thead td, .twtable th, .wizard, .yourSearchResult {border-color: darkgray;}
h5, .popup li.disabled, #backstageTabBar {color: gray;}
.popup, .wizard, .listBreak {border-color: lightgray;}
pre {border: 1px solid lightblue;}
.tabContents {color: deepskyblue;}
h1 {color: #003600;}
h2, h3, h4, h5 {color: #366092;}
.button {border-color: transparent;}
.button:hover {border-color: #db4;}
.button:active {background: #db4; border-color: #841;}

.backstageTabHead, .tabSelected, .tabUnselected, .tab:hover, .tabContents a, .tabContents a:hover, #backstageHide {color: white;}

/* Colors.Backgrounds (sorting: getting darker) */

a:hover {background-color:transparent;}
#tiddlerDisplay, .inputDialogPanel, .wizard {background-color:white;}
body, .twtable thead td, .twtable th, #backstagePanel, .backstageSelTab, pre, .popup, .readOnly {background-color: whitesmoke;}
.yourSearchResult {background: lightyellow;}
.highlight, .marked, .toBeImported .tiddlyLinkExisting {background: yellow;}
.backstageTabHead:hover, .button:hover, .wizardFooter .button:hover {background-color: khaki;}
.dualColorTable tbody td:first-child, .listView tbody td:first-child {background-color: #DEEBF6;} /* Blue 80% */
.error, .errorButton {background: #f88;} /* Red */
.wizardFooter .button {background-color: lightgrey;}
.tab:hover {background-color:#BFBFBF;}
.tab {background-color: darkgray;}
.tabSelected:hover, .tabContents a:hover {background-color:#636363 !important;}
.tabSelected, .tabContents {background-color: #535353 !important;} /* Black 35% */
.tiddlyLink.current {background-color: #333333 !important;} /* Black 35% */
.tiddlyLink.current {box-shadow: 0px 0px 0px 1px #333333;}
#backstageTabBar {background-color: black;}

/* Shadows */

.popup, .wizard, #yourSearchResult {box-shadow: 3px 3px 5px lightgray;}

/* Printing */

@media print {
	#navigationArea, #sidebar, #messageArea, #navAndSearch, .toolbar, #backstageButton, #backstageArea {display: none !important;}
	noscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
}

</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if (window.unload) unload();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<noscript>
	<div id="javascriptWarning">This page requires JavaScript to function properly.</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageTabBar"></div>
<div id="backstagePanel"></div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="internalArticles">
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class="toolbar" macro="toolbar +finishEditing -cancelEditing"&gt;&lt;/div&gt;
&lt;div class="title" macro="view title"&gt;&lt;/div&gt;
&lt;div class="editor" macro="edit title"&gt;&lt;/div&gt;
&lt;div class="editor" macro="edit text"&gt;&lt;/div&gt;
&lt;div class="editor" macro="edit tags"&gt;Tags: &lt;/div&gt;
&lt;div class="editor" macro="edit parenttitle"&gt;Parent:&lt;/div&gt;
&lt;div class="editorFooter"&gt;&lt;span macro="message views.editor.tagHint"&gt;&lt;/span&gt;&lt;span macro="tagChooser"&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;
</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div id='navigationArea'&gt;
	&lt;div id='navigationCollapser' macro='collapseArea navigationPanel'&gt;&lt;/div&gt;
	&lt;div id='navigationPanel' refresh='content' force='true' tiddler='NavigationPanel'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='sidebar'&gt;
	&lt;div id='sidebarCollapser' macro='collapseArea sidebarContent true "Side Bar" "»«"'&gt;&lt;/div&gt;
	&lt;div id='sidebarContent'&gt;
		&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
	&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
	&lt;div id='navAndSearch'&gt;
		&lt;div id='navToolbar'&gt;
			&lt;span id='navButtons' macro='navigate'&gt;&lt;/span&gt;
			&lt;div id='breadcrumbsBox'&gt;&lt;/div&gt;
		&lt;/div&gt;
		&lt;span id='search' macro='search'&gt;&lt;/span&gt;
	&lt;/div&gt;
	&lt;div id='pageWrapper'&gt;
		&lt;div id='messageArea'&gt;&lt;/div&gt;	
		&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
	&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar'&gt;&lt;span macro='toolbar startEditing deleteArticle &gt; references &lt;'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='articleContentContainer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>

</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div title="- Home -" created="201904232038" modified="202001260819" modifier="Anonymous" changecount="45">
<pre>| ''[[Download VodiWiki.zip|http://www.vodi.de/VodiWiki/VodiWiki.zip]]'' (Version &lt;&lt;version&gt;&gt;) |

!What is VodiWiki

* It's a single HTML file containing many documents 
* Built-in viewer with search function
* Built-in editor with local save function
* No cloud, no need to be online
* Portable
* Easy to publish

!Is It For Me?

!!Private Usage

* Use it to keep your notes together in a single file instead of having them spread in several files
* Create your private reference books 

!!Productive Usage

* Use it to document your product
* Put the HTML file on a web server and you're done (no CMS needed)

!!Collaborative Usage? Sync between devices?

* No. (not yet, but in the long term pipeline)

!Getting Started

* Just go here: [[Anatomy Of The Main Window]] (and following pages)

!Some Words on Data Protection

When working with sensitive data consider the following advice:

* Disable all browser plugins - they can read everything in a browser (even password fields, single key strokes, etc.).
* Turned off all &quot;cloud clipboard&quot; functionalities (copy &amp; paste contents will be transferred to your trusted(?) provider.).
** Note: Windows 10 comes with such a &quot;feature&quot; - check if it's enabled.
* Consider using an extra browser for the wiki that is blocked by a firewall

!Sources

* https://github.com/derVodi/VodiWiki

* https://trello.com/b/QffB4q5s/vodiwiki

!License

&lt;&lt;licenseText&gt;&gt;

&lt;html&gt;
	&lt;div style=&quot;position:absolute;top:0;right:2.5em;&quot;&gt;		
		&lt;a href=&quot;http://www.vodi.de/VodiWiki/index-de.html&quot;&gt;
			&lt;svg width=&quot;30&quot; height=&quot;18&quot; viewBox=&quot;0 0 5 3&quot;&gt;&lt;rect width=&quot;5&quot; height=&quot;3&quot; y=&quot;0&quot; x=&quot;0&quot; fill=&quot;#0&quot;/&gt;&lt;rect width=&quot;5&quot; height=&quot;2&quot; y=&quot;1&quot; x=&quot;0&quot; fill=&quot;#D00&quot;/&gt;&lt;rect width=&quot;5&quot; height=&quot;1&quot; y=&quot;2&quot; x=&quot;0&quot; fill=&quot;#FFCE00&quot;/&gt;&lt;/svg&gt;
			Deutsch
		&lt;/a&gt;
	&lt;/div&gt;
&lt;/html&gt;
</pre>
</div>
<div title="Anatomy Of The Main Window" created="201701242104" modified="202001251729" modifier="Anonymous" changecount="37" parenttitle="Getting Started">
<pre>|Backstage Menu (hidden)|&gt;|&gt;|
|Navigation Tabs|← → Navigation Bar| Search|
|Navigation&lt;br&gt;tree or&lt;br&gt;list views|&lt;br&gt;&lt;br&gt;Current Page&lt;br&gt;&lt;br&gt;&lt;br&gt; |&gt;|

!Backstage

* Can be shown by clicking ⌵ at the upper right
* Provides functions like New, Save, Import, Update, etc.

!Navigation Tabs

* Offer different kinds of views of the contained articles
* Can be hidden by clicking « at the left of the navigation bar

!Navigation Bar

* Offers relative navigation
* ← → - Navigates back/forward in view history
* You can click into the bar to jump directly to a parent article

!Search

* Search the content of all articles
</pre>
</div>
<div title="Embedding Parts Of Other Pages" created="201906080811" modified="201906081653" modifier="YourName" changecount="53" parenttitle="​Advanced Use Cases">
<pre>This is useful if you want to create some kind of overview page for other pages (e.g. a thesaurus).

!How To Embed

You'll have to address the page and it's part which you want to embed:

{{{
&lt;&lt;transclude 'PageTitle##SectionName'&gt;&gt;
&lt;&lt;transclude [[PageTitle::SliceName]]&gt;&gt;
}}}

The page title and part name is never embedded - only the inner part.
SliceNames must not contain spaces.

!What Is A &quot;Section&quot;?

Any text between one heading and another heading (or to the end of the document, in the case of the final section) is treated as a part. 
The name of the part is the title. The level of heading (!, !!, !!!, i.e. heading level 1, 2, 3, etc.) is irrelevant for this purpose.

!!!!!!InvisibleSection
This is a section with an invisible heading which can be done using 6 exclamation marks (like this: {{{!!!!!!InvisibleSection}}})

!What Is A &quot;Slice&quot;?

!!Table Cells

|FirstTableCell|Second table cell is the inner part content.|

!!Lines With Colons

SliceName: The text right from the colon (to the line end) is the inner part.&lt;br&gt;This pseudo new line (after {{{&lt;br&gt;}}}) is included.
This real new line is not.

!Example

The following code...

{{{
&lt;&lt;transclude '##What Is A &quot;Section&quot;?'&gt;&gt;
&lt;&lt;transclude 'Embedding Parts Of Other Pages##InvisibleSection'&gt;&gt;
&lt;&lt;transclude [[Embedding Parts Of Other Pages::FirstTableCell]]&gt;&gt;
&lt;&lt;transclude [[Embedding Parts Of Other Pages::SliceName]]&gt;&gt;
}}}

...generates this output:

|&lt;&lt;transclude '##What Is A &quot;Section&quot;?'&gt;&gt;|
|&lt;&lt;transclude 'Embedding Parts Of Other Pages##InvisibleSection'&gt;&gt;|
|&lt;&lt;transclude [[Embedding Parts Of Other Pages::FirstTableCell]]&gt;&gt;|
|&lt;&lt;transclude [[Embedding Parts Of Other Pages::SliceName]]&gt;&gt;|
</pre>
</div>
<div title="Getting Started" created="201904231951" modified="201904231951" modifier="YourName" changecount="1">
<pre></pre>
</div>
<div title="How to Customize Stuff" created="201904232039" modified="202001251730" modifier="Anonymous" changecount="7" parenttitle="Getting Started">
<pre>!The Window Title

* By default this is &quot;VodiWiki&quot;
* This can be changed in the backstage area
</pre>
</div>
<div title="How to Read Content" created="201904232015" modified="201904232018" modifier="YourName" changecount="3" parenttitle="Getting Started">
<pre>Only one page can be read at a time. There's no tabbed browsing.

* Use the tree/list in the left area to directly navigate through the pages
* Use the ← → buttons in the top area to navigate back/forward
* Use the search field to search for content
* Click on links in pages to navigate to other pages</pre>
</div>
<div title="How to Write Content" created="201904232018" modified="202001251849" modifier="Anonymous" changecount="18" parenttitle="Getting Started">
<pre>!Creating a New, Empty Wiki

* Unhide the backstage by clicking ⌵ on the upper right
* In the &quot;File&quot; menu choose &quot;New&quot;
** An empty file will be pushed into your download location.

!Adding a New Page

* Click on &quot;New Article&quot; to add a page on the root level
* Click on &quot;New Sub Article&quot; to add a page below the current page
** The parent of a page can also be changed afterwards (by typing another page title into the &quot;Parent&quot; field)
* Type your text (using [[wiki syntax|Syntax Reference]])
*Commit your edits by pressing the &quot;Done&quot; button or [Ctrl]-[Enter].
** The whole wiki is auto-saved now - some browsers might alert you to acknowledge the saving action.

!Editing an Existing Page

* Place the cursor to the spot you want to edit (or double click a word)
* Click on the &quot;Edit&quot; button in the upper right corner
** The cursor is now located at the previously clicked word

!Deleting a Page

* Navigate to the desired page
* Click on the &quot;Delete&quot; button (upper right area)

!Embedding Images

* Place the image file besides the Wiki-File (or create a sub directory, e.g. &quot;Files&quot;)
* Use a tag like this: {{{[img[Label|Files/Bars.svg]]}}}
** Example: [img[Label|index-Files/Bars.svg]]

!Saving

{{notice{
Never use the browser File/Save functions - this would save the file without your changes!
}}}

* Saving will be done automatically after every change
* &quot;Saving&quot; means: The changed wiki is pushed as a download.
** Due to browser restrictions the wiki cannot overwrite it's original file - therefore the download strategy is the only possible way (yet)
</pre>
</div>
<div title="Index Sorting" created="201906080758" modified="201906080810" modifier="YourName" changecount="4" parenttitle="​Advanced Use Cases">
<pre>Normally the index tree is sorted alphabetically. You can change the order of items only by using a trick:
Add an invisible space in front of the page title to push it at the bottom.

Here is a non printing space you can copy &amp; paste:

|Double click into the right table cell to select and copy to clipboard -&gt;|​|</pre>
</div>
<div title="Keyboard Shortcuts" created="201303170925" modified="201906080808" modifier="YourName" changecount="7" parenttitle="​Reference">
<pre>|Keys|Function|Available|h
|Ctrl-E|Search|Always|
|Ctrl-Enter|Toggle editing|Always|
|Ctrl-K|Edit link|When editing|</pre>
</div>
<div title="Link Variations" created="201701242104" modified="201911231541" modifier="YourName" changecount="42" parenttitle="​Reference">
<pre>|Code|Demo|h
|{{{[[Web link to Startpage|https://www.startpage.com]]}}}|[[Web link to Startpage|https://www.startpage.com]]|
|{{{[[Internal link to another wiki page|Syntax Examples]]}}}|[[Internal link to another wiki page|Syntax Examples]]|
|{{{[[Internal link to another wiki page's headline|Syntax Examples##Links &amp; Stylings]]}}}|[[Internal link to another wiki page's headline|Syntax Examples##Links &amp; Stylings]]|
|{{{[[Internal link to a non existing wiki page|IDoNotExist]]}}}|[[Internal link to a non existing wiki page|IDoNotExist]]|
|{{{[[Labeled Local link to Head 1|##Head 1]]}}}|[[Labeled Local link to Head 1|##Head 1]]|
|{{{Local link to [[##Head 2]]}}}|Local link to [[##Head 2]]|
|{{{[[Local link to table cell B1|##TableCell B1]]}}}|[[Local link to table cell B1|##TableCell B1]]|
|{{{[[Local link to table cell C3|##TableCell C3]]}}}|[[Local link to table cell C3|##TableCell C3]]|
|{{{[[Local link to a named anchor|##MyAnchorName]]}}}|[[Local link to a named anchor|##MyAnchorName]]|
|{{{[img[This is the image tip|Files/Bars.svg][##Head 1]]}}}|[img[This is the image tip|index-Files/Bars.svg][##Head 1]]|
|{{{[img[This is the image tip|Files/Bars.svg][https://startpage.com]]}}}|[img[This is the image tip|index-Files/Bars.svg][https://startpage.com]]|

!Head 1

Some dummy text.

!!Head 2

Some dummy text.

|TableCell A1|TableCell A2|TableCell A3|
|TableCell B1|TableCell B2|TableCell B3|
|TableCell C1|TableCell C2|TableCell C3|

Some dummy text.

Demo code, directly followed by it's output:

{{{
&lt;&lt;anchor 'MyAnchorName' 'Here is an explicite anchor'&gt;&gt; followed by some regular text.
}}}

&lt;&lt;anchor 'MyAnchorName' 'Here is an explicite anchor'&gt;&gt; followed by some regular text.

Some dummy text.
</pre>
</div>
<div title="Syntax Examples" created="201208271404" modified="201912011414" modifier="YourName" changecount="51" parenttitle="​Reference">
<pre>!Headings

{{{
!Heading1
!!Heading2
!!!Heading3
!!!!Heading4
!!!!!Heading5
!!!!!!Heading6 (becomes invisible, used only as section marker)
}}}

!Heading1
!!Heading2
!!!Heading3
!!!!Heading4
!!!!!Heading5
!!!!!!Heading6

!Lists

{{{
*Bullet list
**Bullet list
***Bullet list&lt;br&gt;with line break
***Bullet list same level
****Bullet list

#Numbered list
##Numbered list
###Numbered list
####Numbered list
}}}

*Bullet list
**Bullet list
***Bullet list&lt;br&gt;with line break
***Bullet list same level
****Bullet list

#Numbered list
##Numbered list
###Numbered list
####Numbered list

!Tables

&lt;html&gt;&lt;pre&gt;
|table|table| centered header |h
|table|table|left aligned text is default|
|table|table| right|
|table|table| centered |

{{dualColorTable{
|Foo ▸&amp;lt;br&amp;gt;▾ Bar|This|That|h
|Ding|Cell Content|Cell Content|
|Batz|Cell Content|Cell Content|
}}}&lt;/pre&gt;&lt;/html&gt;

|table|table| centered header |h
|table|table|left aligned text is default|
|table|table| right|
|table|table| centered |

{{dualColorTable{
|Foo ▸&lt;br&gt;▾ Bar|This|That|h
|Ding|Cell Content|Cell Content|
|Batz|Cell Content|Cell Content|
}}}

!Links &amp; Stylings

&lt;html&gt;&lt;pre&gt;
Regular Text with @@highlighted@@ part.

Link to wiki page with title [[Syntax Reference]]

Web-link to [[Startpage|https://www.startpage.com]]

{{notice{
This is an explicite notice which will be decorated with a symbol and khaki background color.
Line breaks are possible.
}}}

{{TODO{Marks an unfinished part of an article}}}
&lt;/pre&gt;&lt;/html&gt;

Regular Text with @@highlighted@@ part.

Link to wiki page with title [[Syntax Reference]]

Web-link to [[Startpage|https://www.startpage.com]]

{{notice{
This is an explicite notice which will be decorated with a symbol and khaki background color.
Line breaks are possible.
}}}

{{TODO{Marks an unfinished part of an article}}}

!Pre-Formatted Text

&lt;html&gt;&lt;pre&gt;
Some text with a {{{code snippet}}} in the middle.

{{{
Code-Block
  Code-Block with 2 leading spaces
	Code-Block with 1 leading tab
Code-Block
}}}&lt;/pre&gt;&lt;/html&gt;

Some text with a {{{code snippet}}} in the middle

{{{
Code-Block
  Code-Block with 2 leading spaces
	Code-Block with 1 leading tab
Code-Block
}}}

!Quoted Blocks

{{{
&lt;&lt;&lt;
Several lines of blockquoted text.
Several lines of blockquoted text.
&lt;&lt;&lt;

&gt; If you want to create nested blockquotes,
&gt; you'll have to mark every single line.
&gt;&gt; Bla
&gt;&gt;&gt; Bla
}}}

&lt;&lt;&lt;
Several lines of blockquoted text.
Several lines of blockquoted text.
&lt;&lt;&lt;

&gt; If you want to create nested blockquotes,
&gt; you'll have to mark every single line.
&gt;&gt; Bla
&gt;&gt;&gt; Bla
</pre>
</div>
<div title="Syntax Reference" created="201208280946" modified="202001260754" modifier="Anonymous" changecount="50" parenttitle="​Reference">
<pre>|Headings|Lists|Lists|Formatting|Code|h
|{{{!Heading 1}}}&lt;br&gt;{{{!!Heading 2}}}&lt;br&gt;{{{!!!Heading 3}}}|{{{*Unordered 1}}}&lt;br&gt;{{{**Unordered 2}}}&lt;br&gt;{{{***Unordered 3}}}|{{{#Ordered 1}}}&lt;br&gt;{{{##Ordered 2}}}&lt;br&gt;{{{###Ordered 3}}}|{{{''Bold text''}}}&lt;br&gt;{{{//Italic text//}}}&lt;br&gt;{{{--Strikethrough text--}}}&lt;br&gt;{{{@@Highlighted text@@}}}&lt;br&gt;{{{{{notice{Your notice text.}}}}}}&lt;br&gt;{{{@@css:value;css:value;text@@}}}&lt;br&gt;{{{{{class{styled text}}}}}}|&lt;html&gt;&lt;code&gt;{{{Monospaced text}}}&lt;/code&gt;&lt;/html&gt;&lt;br&gt;&quot;&quot;&quot;{{{&quot;&quot;&quot;&lt;br&gt;{{{ Code Block}}}&lt;br&gt;&quot;&quot;&quot;}}}&quot;&quot;&quot;|

|Tables|Linking &amp; Embedding|Escaping|h
|{{{|Table caption|c}}}&lt;br&gt;{{{|Heading 1|Heading 2|h}}}&lt;br&gt;{{{|Table|Footer|f}}}&lt;br&gt;{{{|!Heading 1|!Heading 2|}}}&lt;br&gt;{{{| Centered |cell|}}}&lt;br&gt;{{{|Left-Aligned |cell|}}}&lt;br&gt;{{{| Right-Aligned|cell|}}}&lt;br&gt;{{{|bgcolor(blue):Coloured|cell|}}}&lt;br&gt;{{{|&gt;|Colspan cell|}}}&lt;br&gt;{{{|Rowspan|cells|}}}&lt;br&gt;{{{|~|~|}}}|{{{[[PageTitle]]}}}&lt;br&gt;{{{[[Label|PageTitle]]}}}&lt;br&gt;{{{[[Label|##PageElement]]}}}&lt;br&gt;{{{[[Label|PageTitle##PageElement]]}}}&lt;br&gt;{{{[[Label|https://foo.com]]}}}&lt;br&gt;{{{[img[Label|LocalFileName.png]]}}}&lt;br&gt;{{{[img[Label|LocalFileName.png][PageTitle]]}}}&lt;br&gt;{{{[img[Label|LocalFileName.png][https://foo.com]]}}}|{{{&lt;br&gt;}}} - Line Break&lt;br&gt;{{{&quot;&quot;&quot;Escaped Text&quot;&quot;&quot;}}}&lt;br&gt;{{{/%Invisible Comment%/}}}&lt;br&gt;{{{&lt;html&gt;Raw HTML&lt;/html&gt;}}}|





</pre>
</div>
<div title="SystemSettings" created="201912221052" modified="201912221052" modifier="Anonymous" changecount="3">
<pre>txtUserName: Anonymous
txtWikiTitle: VodiWiki
</pre>
</div>
<div title="Unicode Collection" created="201907110746" modified="202002091613" modifier="Anonymous" changecount="132" parenttitle="​Reference">
<pre>{{notice{
Some of the glyphs are composed of 2 characters: The glyph itself + FE0E (&quot;Variation Selector 15&quot;).
Otherwise you loose control over the appearance of the glyph and the browsers will  render them as colorful emoji.
}}}

!Spaces &amp; Control Characters

|NBSP|1 EM|½ EM|0 EM|Marker|Text|Emoji|
|&amp;nbsp;|&amp;#x2003;|&amp;#x2002;|&amp;#x200B;|␣|︎&amp;#xFE0E;|️&amp;#xFE0F;|
!!!!!Double click cell, then press [Ctrl]-[C]

!Arrows

|&gt;|&gt;|&gt;|&gt;|Regular||&gt;|&gt;|&gt;|&gt;|Triangle Head||&gt;|&gt;|&gt;|&gt;|Black||&gt;|&gt;|&gt;|&gt;|White|
|←|→|↖|↗|↔|~|⭠|⭢|⭦|⭧|⭤ |~|⬅|➡|⬉|⬈|⬌|~|⇦|⇨|⬁|⬀|⬄|
|↑|↓|↙|↘|↕|~|⭡|⭣|⭩|⭨|⭥|~|⬆|⬇|⬋|⬊|⬍|~|⇧|⇩|⬃|⬂|⇳|
|⇇|⇉|⇆|⇄|⤡|~|⮄|⮆|⮀|⮂||~||||||~|⇐|⇒|⇖|⇗|⇔|
|⇈|⇊|⇅|⇵|⤢|~|⮅|⮇|⮁|⮃||~||||||~|⇑|⇓|⇙|⇘|⇕|
|↱|↰|⬐|⬎||~|⮣|⮢|⮦|⮧||~|⮫|⮪|⮮|⮯||~|⮳|⮲|⮶|⮷||
|↳|↲|⬑|⬏||~|⮡|⮠|⮤|⮥||~|⮩|⮨|⮬ |⮭||~|⮱|⮰|⮴|⮵||
|⇤|⇥|⇱||↹|~|⭰|⭲|⭶|⭷|⭾|~||||||~|⇽|⇾|||⇿|
|⤒|⤓||⇲|↨|~|⭱|⭳|⭹|⭸|⭿|~||||||~||||||
|⇠|⇢||||~|⭪|⭬ |⮌|⮎||~||||||~||||||
|⇡|⇣||||~|⭫|⭭|⮍|⮏||~||||||~||||||

|↤|↦|↥|↧|⍇|⍈|⍐|⍗||⟵|⟶|⟷|⟻|⟼|⬳|⟿|
|⬸|⤑|⤌|⤍|⤎|⤏|⤝|⤞|~|⟸|⟹|⟺|⟽|⟾|||

|⤶|⤷|⤴|⤵|⟲|⟳|↺|↻|🗘|⮔|↵|↯|⚡︎︎|
|↩|↪|↶|↷|⥀|⥁|🔄︎︎|🔁︎︎|🔃︎︎||⏎|⭍||

|◀|▶|▲|▼|◢|◣|◥|◤|◄|►|≺|≻|∧|∨|⋖|⋗|⌲|⸢|⸣|⸝|⸜|◜|◝|
|◁|▷|△|▽|◿|◺|◹|◸|◅|▻|⮜|⮞|⮝|⮟|≪|≫|◬|⸤|⸥|⸌|⸍|◟|◞|
|◂|▸|▴|▾|◃|▹|▵|▿||⌳|⮘|⮚|⮙|⮛|⋘|⋙|⌵|⌈|⌉|「|」|◠|
|||||||||||⍃|⍄|⍓|⍌|〈|〉||⌊|⌋|『|』|◡|

!UI Widgets

|🗔|🗕|🗖|🗗|🗙|⨯|⌵|☰|…|⋮|⌂|🏠︎︎|⚙|⛭|⏣|⚒|✎|🖉|
|📄︎︎|📂︎︎|💾︎︎|✂|🗐|📋︎︎|↶|↷|👤︎︎|👥︎︎|🝖|🔎︎︎|⎗|⎘|🗑|
|💾︎︎| 📁︎︎|📂︎︎|📁︎︎|📂︎︎|🖿|🗀|🗁|🖴|🖧|🗄|🗜|
|📄︎︎|📃︎︎|📜︎︎|🗆|🗅|🗌|🗋|🗉|🗈|🗏|🗎|🖹|🗇|🗊|🗍|🗐|
|🗒|🗓|📝︎︎|📋︎︎|📛︎︎|🗟|🖺|🖻|🖼|🖽|🖾|
|💻︎︎|🖳|🖵|🖥|⌨|🖮|⎙|🗑|🕓︎︎|
|🛈|⚠|⮿|🅧|☐|☑|☒|⚪︎︎|🔘︎︎|🗸|✓|✔|
|⚓︎︎|🔗︎︎|🔒︎︎|🔓︎︎|🔏︎︎|🔐︎︎|⚿|🔑︎︎|🗝|🌍︎︎|🌐︎︎|
|🗢|🗣|🗨|💬︎︎|🗪|🗫|🗬|🗭|🗮|🗯|🗰|💭|

!Abstract

|·|•|⚉|⚫︎︎|●|⬤|◦|⚬|⚪|○|○|◯|☉|⚇|⊙|⊚|⦾|⦿|⊛|⊝|⊜|⊕|⊖|⊗|⊘|◌|◍|◎|◖|◗|⯊|⯋|
|Ⓞ|①|②|③|④|⑤|⑥|⑦|⑧|⑨|⑩|♾|
|▪|◾|◼|■|⬛︎︎|▫|◽|◻|□|⬜|🔲︎︎|🔳︎︎|🖵|⛶|⛚|⊞|⊟|⊠|⊡|▣|⛋|🝙|🝚|▍|
|◆|⋄|◇|⎔|⬟|⬢|⬣|🔶︎︎|🔷︎︎|🔸︎︎|🔹︎︎|◈|⟐|💠︎︎|🞡|🞢|🞣|🞤|🞥|🞦|🞧|✙|✚|✛|✜|
|⿰|⿱|⿳|⿲|⿴|⿵|⿶|⿷|⿸|⿹|⿺|⿻|▤|▥|▦|⩩|⫵|
|☷|☰|≡|≣|⌯|⚌|⚏|𝌮|𝌀|𝌅|𝍖|𝌠|𝍔|𝌞|⠸|⠇|⡆|⠐|⠒|⠛|⠤|⠨|⠭|⠶|⠿|⣿|…|⋮|⋮|⋯|⋰|⋱|﹍|
|⑅|⑀|⑁|⑂|⑃|⑄|🝗|🝘|🜙|⊶|⊷|⊸|⚯|🜺|🝓|🝢|☍|☌|🝯|🝰|☊|☋|⎌|⚮|⚭|🝆|⚲|🜣|⟟|⫱|🜽|⍝|⊍|
|⎎|⏍|⍞|⍠|⎕|⎄|⎅|␣|⌴|⍽|⎍|⌶|⏙|⟝|⟞|⊢|⊣|⊤|⊥|⟛|⧿|ꕯ|⥐|

!Emojis

¯ \ _ (ツ) _ / ¯
|ꙭ|Ꙭ|👀|💩|💣|💤|👑|🜲|⚡|
|😃|😢|👍|👎|🖕|❤️|💀|🕱|💬|
|🖖|👽|👾|⍾|🜶|🜸|☄|🕳|
|📄|🗐|📋|👤|👥|🔎|🔄|🔁|🔃|
|💻|💾| 📁|📂|📁|📂|🕓|
|⚓|🔗|🔒|🔓|🔏|🔐|🔑|🌍|🌐|
|⚫|⬛|🔲|🔳|🔶|🔷|🔸|🔹|💠|

!Web Links

*[[Name Search|https://unicode-search.net/unicode-namesearch.pl]]
*[[Shape Catcher|http://shapecatcher.com]]
*[[Spaces|http://jkorpela.fi/chars/spaces.html]]
*[[Xah Lee|http://xahlee.info/comp/unicode_index.html]]
*File Format Info
**[[Arrows|https://www.fileformat.info/info/unicode/block/arrows/utf8test.htm]], [[Misc|http://www.fileformat.info/info/unicode/block/miscellaneous_symbols_and_arrows/utf8test.htm]], [[Supplemental A|https://www.fileformat.info/info/unicode/block/supplemental_arrows_a/utf8test.htm]], [[Supplemental B|https://www.fileformat.info/info/unicode/block/supplemental_arrows_b/utf8test.htm]], [[Supplemental C|https://www.fileformat.info/info/unicode/block/supplemental_arrows_c/utf8test.htm]]
**[[Box Drawing|https://www.fileformat.info/info/unicode/block/box_drawing/utf8test.htm]]
**[[Dingbats|https://www.fileformat.info/info/unicode/block/dingbats/utf8test.htm]]
**[[Enclosed Alphanumerics|http://www.fileformat.info/info/unicode/block/enclosed_alphanumerics/utf8test.htm]], [[Supplement|http://www.fileformat.info/info/unicode/block/enclosed_alphanumeric_supplement/utf8test.htm]]
**[[Geometric Shapes|https://www.fileformat.info/info/unicode/block/geometric_shapes/utf8test.htm]]
**[[Mathematical Operators|http://www.fileformat.info/info/unicode/block/mathematical_operators/utf8test.htm]]
**[[Technical|https://www.fileformat.info/info/unicode/block/miscellaneous_technical/utf8test.htm]]
**[[Symbols|http://www.fileformat.info/info/unicode/block/miscellaneous_symbols/utf8test.htm]], [[Pictographs|http://www.fileformat.info/info/unicode/block/miscellaneous_symbols_and_pictographs/utf8test.htm]], [[Transport|http://www.fileformat.info/info/unicode/block/transport_and_map_symbols/utf8test.htm]], [[Supplemental|https://www.fileformat.info/info/unicode/block/supplemental_symbols_and_pictographs/utf8test.htm]], [[Other|https://www.fileformat.info/info/unicode/category/So/list.htm]]
</pre>
</div>
<div title="Updating the Viewer" created="202001252100" modified="202001252110" modifier="Anonymous" changecount="3" parenttitle="​Advanced Use Cases">
<pre>! How To

* The viewer and editor can be updated via the backstage area (unhide by clicking ⌵ at the upper right)
* Choose &quot;About / Upgrade&quot;
* The updater will save an updated HTML file preserving your content

! Major Updates

* Major updates will only happen, if the content would need to be migrated due to internal changes
* In this case, you cannot skip major versions, e.g. from 1.x.x to 3.x.x
* You would need to update twice, from 1.x.x to 2.x.x to 3.xx
* This is because the content will be migrated between the major versions
</pre>
</div>
<div title="VodiConfigPlugin" kind="!" created="201208271031" modified="201702011759" modifier="YourName" changecount="24">
<pre>/***
|''Name:''|VodiConfigPlugin|
|''Version:''|2016.01.08|
|''Description:''|Configures the core and 3rd party plugins|
|''Requires:''|TagsTreePlugin YourSearchPlugin|
!Code
***/
//{{{
	// nix.
//}}}
</pre>
</div>
<div title="​Advanced Use Cases" created="201906080756" modified="201906080757" modifier="YourName" changecount="1">
<pre></pre>
</div>
<div title="​Reference" created="201906080803" modified="201906080807" modifier="YourName" changecount="8">
<pre></pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->

<!--POST-BODY-END-->
<!--JS-START-->
<script src="Libraries/Array.js"></script>
<script src="Libraries/Date.js"></script>
<script src="Libraries/String.js"></script>
<script src="Libraries/UI.js"></script>
<script src="Libraries/JQuery.js"></script>
<script src="Engine/Preparations.js"></script>
<script src="CopyAndPaste/CopyAndPaste.js"></script>
<script src="Customizability/Customizability.js"></script>
<script src="Data/Tiddler.js"></script>
<script src="Data/ArticleStore.js"></script>
<script src="Data/Data.js"></script>
<script src="Data/FileImporter.js"></script>
<script src="Editing/Editing.js"></script>
<script src="Engine/Engine.js"></script>
<script src="ErrorHandling/ErrorHandling.js"></script>
<script src="FileSystem/FileSystem.js"></script>
<script src="Importing/ImporterUi.js"></script>
<script src="KeyboardHandling/GlobalKeys.js"></script>
<script src="LinkHandling/LinkHandling.js"></script>
<script src="Localization/Localization.js"></script>
<script src="Networking/Networking.js"></script>
<script src="Persistence/Persistence.js"></script>
<script src="PluginSystem/PluginEngine.js"></script>
<script src="PluginSystem/PluginUi.js"></script>
<script src="Searching/Searching.js"></script>
<script src="Tagging/Tagging.js"></script>
<script src="UI/ArticleTree.js"></script>
<script src="UI/Backstage.js"></script>
<script src="UI/Breadcrumbs.js"></script>
<script src="UI/ListView.js"></script>
<script src="UI/Popup.js"></script>
<script src="UI/PopUpSupport.js"></script>
<script src="UI/Story.js"></script>
<script src="UI/Transclusion.js"></script>
<script src="UI/Toolbar.js"></script>
<script src="UI/WizardPresenter.js"></script>
<script src="Updating/UpdaterUi.js"></script>
<!--JS-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[

//--
//-- Main
//--

if (! window || ! window.console) {
	console = {tiddlywiki: true, log: function(message) {displayMessage(message);}};
}

// Starting up
function main() {
	window.originalHTML = recreateOriginal();
	// todo hier wird ein riesen snapshot gemacht - stattdessen sollte recreateOriginal() so gepimpt werden, dass auch später dynamisch befüllte interne DIVs ALLE geleert werden!
	
	startingUp = true;
	// var doc = jQuery(document);
	jQuery.noConflict();
	window.onbeforeunload = function(e) {if (window.confirmExit) return confirmExit();};
	
	// process the right part of an url after a hash sign
	if (window.location.hash) params = decodeURIComponent(window.location.hash.substr(1));	
	if (params)	params = params.parseParams("open", null, false);
		
	store = new ArticleStore({config: config});
		
	story = new Story("tiddlerDisplay");
	
	document.addEventListener("click", Popup.onDocumentClick, false);
	
	saveTest();
	var s;
	for (s = 0; s < config.notifyTiddlers.length; s++) {
		store.addNotification(config.notifyTiddlers[s].name, config.notifyTiddlers[s].notify);
	}

	populateInternalArticlesFromStaticHtml();	

	store.loadFromDiv(document.getElementById("storeArea"), true);
	
	loadOptions();
	
	readOnly = window.isLocal() ? false : config.options.chkHttpReadOnly;
	
	var pluginProblem = loadPlugins();

	formatter = new Formatter(config.formatters);
	
	var m;
	for (m in config.macros) {
		if (config.macros[m].init) config.macros[m].init();
	}
	
	store.notifyAll();
	
	restart();
	refreshDisplay();
	
	if (pluginProblem) {
		story.showArticle("PluginManager");
		displayMessage(config.messages.customConfigError);
	}	
	backstage.init();
		
	startingUp = false;
	// doc.trigger("startup");
}

//--
//-- Paramifiers
//--

function invokeParamifier(params, handler) {
	if (! params || params.length == undefined || params.length <= 1)
		return;
	var i;
	for (i = 1; i < params.length; i++) {
		var p = config.paramifiers[params[i].name];
		if (p && p[handler] instanceof Function)
			p[handler](params[i].value);
		else {
			var h = config.optionHandlers[params[i].name.substr(0,3)];
			if (h && h.set instanceof Function)
				h.set(params[i].name, params[i].value);
		}
	}
}

config.paramifiers = {};

config.paramifiers.open = {
	onstart: function(title) {
		if (! readOnly || store.tiddlerExists(title) || isShadowTiddler(title))	story.showArticle(title);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters) {
	var n;
	this.formatters = [];
	var pattern = [];
	for (n = 0; n < formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"), "mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)	{
		w.subWikifyTerm(createTiddlyElement(w.output, this.element), this.termRegExp);
	},

	inlineCssHelper: function(w)	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while (lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if (lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if (s == "bgcolor") s = "backgroundColor";
			if (s == "float") s = "cssFloat";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)	{
		var t;
		for (t = 0; t < styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if (config.browser.isIE && (config.browser.ieVersion[1] < 10)) text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link) {

		link = link.split(config.textPrimitives.sectionSeparator)[0]; // handle internal section links (e.g. "foo##bar" => "foo" or "##bar" => "")
		
		if (!link.length || store.tiddlerExists(link) || isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern, "mg");
		if (urlRegExp.exec(link)) {
			return true;
		}
		if (link.indexOf(".") != -1 || link.indexOf("\\") != -1 || link.indexOf("/") != -1 || link.indexOf("#") != -1) {
			return true;
		}
		return false;
	}

};

function resolveImageSource(unresolved){
	if (! unresolved || unresolved.indexOf('/') > -1)	return unresolved;	
	var blobArticle = store.getArticle(unresolved);
	if (! blobArticle) return "./%0-Files/%1".format([getFileName(document.location.toString(), true), unresolved]);	
	return blobArticle.text;
}

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},
	handler: function(w) {
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		var onmouseover = function() {jQuery(this).addClass("hoverRow");};
		var onmouseout = function() {jQuery(this).removeClass("hoverRow");};
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while (lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if (nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if (nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if (currRowType == "c") {
					// Caption
					w.nextMatch++;
					if (rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					var theRow = createTiddlyElement(rowContainer,"tr",null,rowCount%2?"oddRow":"evenRow");
					theRow.onmouseover = onmouseover;
					theRow.onmouseout = onmouseout;
					this.rowHandler(w,theRow,prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns) {
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while (cellMatch && cellMatch.index == w.nextMatch) {
			if (cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if (last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
					if (colSpanCount > 1) {
						last.element.setAttribute("colspan",colSpanCount);
						last.element.setAttribute("colSpan",colSpanCount); // Needed for IE
						colSpanCount = 1;
					}
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if (cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if (cellMatch[2]) {
				// End of row
				if (prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while (chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if (chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if (colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if (w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if (spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w) {
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w) {
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType, baseType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while (lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if (lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if (lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if (lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if (lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			if (!baseType)
				baseType = listType;
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if (listLevel > currLevel) {
				for (t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target, listType));
				}
			} else if (listType!=baseType && listLevel==1) {
				w.nextMatch -= lookaheadMatch[0].length;
				return;
			} else if (listLevel < currLevel) {
				for (t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if (listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w) {
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t, matched;
		do {
			if (newLevel > currLevel) {
				for (t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if (newLevel < currLevel) {
				for (t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if (matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while (matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?|<hr ?/?>\\n?",
	handler: function(w) {
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
	element: "pre",
	handler: function(w) {
		switch(w.matchText) {
		case "/*{{{*/\n": // CSS
			this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\*\}\}\}\*\/$\n?)/mg;
			break;
		case "{{{\n": // monospaced block
			this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\f*\}\}\}$\n?)/mg;
			break;
		case "//{{{\n": // plugin
			this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\/\}\}\}$\n?)/mg;
			break;
		case "<!--{{{-->\n": //template
			this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^\f*<!--\}\}\}-->$\n?)/mg;
			break;
		default:
			break;
		}
		config.formatterHelpers.enclosedTextHelper.call(this,w);
	}
},

{
	name: "wikifyComment",
	match: "^(?:/\\*\\*\\*|<!---)\\n",
	handler: function(w) {
		var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
		w.subWikifyTerm(w.output,termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var linkElement;
			var text = lookaheadMatch[1];
			if (lookaheadMatch[3]) { // Pretty bracketted link
				var link = lookaheadMatch[3];
				linkElement = (! lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link))
					? renderExternalLink(w.output, link) 
					: renderLinkElement(w.output, link, false, null, w.isStatic)
				;
			} else {
				// Simple bracketted link
				linkElement = renderLinkElement(w.output, text, false, null, w.isStatic);
			}
			if (text.substring(0, 2) == config.textPrimitives.sectionSeparator) text = text.substring(2); // remove leading "##" of local section links.
			createTiddlyText(linkElement, text); // before, the linkElement has been rendered without innerHtml. We've now inserted the text as innerHtml.
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w) {
		w.outputText(renderExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if (lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = (
					config.formatterHelpers.isExternalLink(link) ?
					renderExternalLink(w.output, link) :
					renderLinkElement(w.output, link, false, null, w.isStatic, w.tiddler)
				);
				jQuery(e).addClass("imageLink");
			}
			var img = createTiddlyElement(e, "img");
			if (lookaheadMatch[1])
				img.align = "left";
			else if (lookaheadMatch[2])
				img.align = "right";
			if (lookaheadMatch[3]) img.title = lookaheadMatch[3];
			img.src = resolveImageSource(lookaheadMatch[4]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output, "span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "characterFormat",
	match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
	handler: function(w) {
		switch (w.matchText) {
		case "''":
			w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
			break;
		case "//":
			w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
			break;
		case "__":
			w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
			break;
		case "^^":
			w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
			break;
		case "~~":
			w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
			break;
		case "--":
			w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
			break;
		case "{{{":
			var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if (lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
				w.nextMatch = lookaheadRegExp.lastIndex;
			}
			break;
		}
	}
},

{
	name: "customFormat",
	match: "@@|\\{\\{",
	handler: function(w) {
		switch(w.matchText) {
		case "@@":
			var e = createTiddlyElement(w.output,"span");
			var styles = config.formatterHelpers.inlineCssHelper(w);
			if (styles.length == 0)
				e.className = "marked";
			else
				config.formatterHelpers.applyCssHelper(e,styles);
			w.subWikifyTerm(e,/(@@)/mg);
			break;
		case "{{":
			var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if (lookaheadMatch) {
				w.nextMatch = lookaheadRegExp.lastIndex;
				e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
				w.subWikifyTerm(e,/(\}\}\})/mg);
			}
			break;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w) {
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w) {
		createTiddlyElement(w.output, "br");
	}
},

{
	name: "rawText",
	match: "\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if (lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w) {
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler, format) {
	if (tiddler) {
		if (! format)
			format = tiddler.fields["wikiformat"];
		var i;
		if (format) {
			for (i in config.parsers) {
				if (format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for (i in config.parsers) {
				if (tiddler.isTagged(config.parsers[i].formatTag)) return config.parsers[i];
			}
		}
	}
	return formatter;
}

function Wikifier(wikiSyntaxText, formatter, highlightRegExp, tiddler) {
	this.source = wikiSyntaxText;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if (highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(wikiSyntaxText);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function() {
	var e = createTiddlyElement(document.body, "div");
	e.style.display = "none";
	this.subWikify(e);
	var text = jQuery(e).text();
	jQuery(e).remove();
	return text;
};

Wikifier.prototype.subWikify = function(targetDomElement, terminator) {
	try {
		if (terminator) //# Handle the terminated and unterminated cases separately, this speeds up wikifikation by about 30%
			this.subWikifyTerm(targetDomElement, new RegExp("(" + terminator + ")","mg"));
		else
			this.subWikifyUnterm(targetDomElement);
	} catch(ex) {
		showException(ex);
	}
};

Wikifier.prototype.subWikifyUnterm = function(targetElement) {
	var oldOutput = this.output; //# subWikify can be indirectly recursive, so we need to save the old output pointer
	this.output = targetElement;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;//# Get the first match
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while (formatterMatch) {
		// Output any text before the match
		if (formatterMatch.index > this.nextMatch)
			this.outputText(this.output, this.nextMatch, formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		//# Figure out which formatter matched and call its handler
		var t;
		for (t = 1; t < formatterMatch.length; t++) {
			if (formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		//# Get the next match
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	//# Output any text after the last match
	if (this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	//# Restore the output pointer
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output, terminatorRegExp) {
	var oldOutput = this.output;
	this.output = output;
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while (terminatorMatch || formatterMatch) {
		if (terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if (terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if (formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		var t;
		for (t=1; t<formatterMatch.length; t++) {
			if (formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if (this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place, startPos, endPos) {
	while (this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if (this.highlightMatch.index > startPos) {
			createTiddlyText(place, this.source.substring(startPos, this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if (startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if (startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

function wikify(wikiSyntaxText, targetDomElement, highlightRegExp, tiddler) {
	if (wikiSyntaxText) {
		var wikifier = new Wikifier(wikiSyntaxText, getParser(tiddler), highlightRegExp, tiddler);		
		wikifier.subWikify(targetDomElement);	
	}
}

function wikifyPlainText(text,limit,tiddler) {
	if (limit > 0) text = text.substr(0, limit);
	var wikifier = new Wikifier(text, formatter, null, tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler) {
	if (source) {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

//--
//-- Macro definitions
//--

/**
	* @typedef {Object} IMacroResolver
	*
	* A Module that will be called (IOC by invokeMacro()) when a macro (like "<<toolbar +finishEditing -cancelEditing deleteArticle>>") is resolved.
	* The name of the actual implementation must match the macro name.
	*
	* @property {function} handler - The actual resolving function, that should render stuff into "place"	
*/

/**
	* IMacroResolver.handler()
	*
	* @param {element}  place               - The target dom element (toolbar div), into which a macro "handler" should render stuff.
	* @param {string}   macroName           - The name of the macro for which an implementation will be located.
	* @param {string[]} preParsedParameters - ???
	* @param {string}   wikifier            - ???
	* @param {string}   params              - Generic parameter string (cut from the macro token from the article)
	* @param {Object}   tiddler             - The currently processed article for which the macro is resolved.	
*/

/**
	* This will locate a macro module implementation (by name) and invoke it's "handler",
	* which will resolve the macro and (mostly) render stuff into the target "place" element.
	*
	* @param {element} place     - The target dom element (toolbar div), into which a macro "handler" should render stuff.
	* @param {string}  macroName - The name of the macro for which an implementation will be located.
	* @param {string}  params    - Generic parameter string that will be passed to the macro "handler".
	* @param {string}  wikifier  - Seems to be always null.	
	* @param {Object}  tiddler   - The currently processed article entity for which the macro is resolved.
*/
function invokeMacro(place, macroName, params, wikifier, tiddler) {
	try {
		var iMacroResolver = config.macros[macroName]; // Dynamically find the macro module implementation by name (VB = GetType("config.macros." + macroName))
		if (iMacroResolver && iMacroResolver.handler) { // We hope that the module implements IMacroResolver
			var articleView = story.getArticleViewByChild(place);
			window.tiddler = articleView ? store.getArticle(articleView.getArticleTitle()) : null;
			window.place = place;
			var allowEval = true;
			if (config.evaluateMacroParameters == "system") {
				if (!tiddler || tiddler.tags.indexOf("systemAllowEval") == -1) {
					allowEval = false;
				}
			}
			
			// Actually invoke the macro implementation's "handler" (hoping the signature would match)			
			iMacroResolver.handler(place, macroName, params.readMacroParams(! allowEval), wikifier, params, tiddler); // see IMacroResolver.handler()
			
		} else {
			createTiddlyError(place, config.messages.macroError.format([macroName]), config.messages.macroErrorDetails.format([macroName,config.messages.missingMacro]));
		}
	} catch(ex) {
		createTiddlyError(place, config.messages.macroError.format([macroName]), config.messages.macroErrorDetails.format([macroName,ex.toString()]));
	}
}

config.macros.collapseArea = {	
	defaultTooltip: "Hide / Unhide"
};

config.macros.collapseArea.handler = function(place, macroName, params) { // Implements IMacroResolver.handler()
	// process command line parameters	
	var elementID = params[0];
	var startHidden = (params[1] == "true");
	var tooltip = params[2] || this.defaultTooltip;
	var buttonSymbols = params[3] || "«»"
	var buttonClass = params[4] || "button collapserButton";	
	// create toggle button
	var button = renderTiddlyButton(
		place, buttonSymbols[0], tooltip,
		function() {config.macros.collapseArea.toggle(this, elementID);},
		buttonClass
	);
	button.buttonSymbols = buttonSymbols;
	
	if (startHidden == true) config.macros.collapseArea.toggle(button, elementID);
};

config.macros.collapseArea.toggle = function(sender, id) {
	var e = document.getElementById(id);
	if (e) {
		if (e.style.display != "none") {
			e.style.display = "none";
			sender.innerHTML = sender.buttonSymbols[1];
		} else {
			e.style.display = "";
			sender.innerHTML = sender.buttonSymbols[0];
		}
	}
};

config.macros.licenseText = {};

config.macros.licenseText.handler = function(place) { // Implements IMacroResolver.handler()
	var s = createTiddlyElement(place, "span", null, "licenseText");
	s.innerHTML =  document.querySelector('meta[name="copyright"]').content.lineBreaksToBr();
};

config.macros.version.handler = function(place) { // Implements IMacroResolver.handler()
	jQuery("<span/>").text(formatVersion()).appendTo(place);
};

config.macros.today.handler = function(place, macroName, params) { // Implements IMacroResolver.handler()
	var now = new Date();
	var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
	jQuery("<span/>").text(text).appendTo(place);
};

config.macros.list.template = "<<view title link>>";

config.macros.list.handler = function(place, macroName, params, wikifier, paramString) { // Implements IMacroResolver.handler()
	var list = document.createElement("ul");
	jQuery(list).attr({ refresh: "macro", macroName: macroName }).data("params", paramString);
	place.appendChild(list);
	this.refresh(list);
};

config.macros.list.refresh = function(list) {
	var paramString = jQuery(list).data("params");
	var params = paramString.readMacroParams();
	var args = paramString.parseParams("anon", null, null)[0];
	var type = args.anon ? args.anon[0] : "all";
	jQuery(list).empty().addClass("list list-" + type);
	var template = args.template ? store.getArticleTextPartOrSlice(args.template[0]) : false;
	if (!template) {
		template = config.macros.list.template;
	}
	if (this[type].hint)
		createTiddlyElement(list, "li", null, "listTitle", this[type].hint);
	var results;
	if (this[type].handler)
		results = this[type].handler(params);
	var t;
	for (t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		var tiddler = results[t];
		if (typeof(tiddler) == 'string') {
			tiddler = store.getArticle(tiddler) || new Tiddler(tiddler); // HACK: type of "tiddler" changes from string to article!
		}
		wikify(template, li, null, tiddler);
	}
	if (results.length === 0 && args.emptyMessage) {
		jQuery(list).addClass("emptyList");
		jQuery("<li />").text(args.emptyMessage[0]).appendTo(list);
	}
};

config.macros.list.all.handler = function(params) { // Implements IMacroResolver.handler()
	return store.getArticlesQuickly("title");
};

config.macros.list.missing.handler = function(params) { // Implements IMacroResolver.handler()
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params) { // Implements IMacroResolver.handler()
	return store.getOrphans();
};

config.macros.list.resources.handler = function(params) { // Implements IMacroResolver.handler()
	return store.getResourceTitles();
};

config.macros.list.shadowed.handler = function(params) { // Implements IMacroResolver.handler()
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params) { // Implements IMacroResolver.handler()
	return store.getTouched();
};

config.macros.list.filter.handler = function(params) { // Implements IMacroResolver.handler()
	var filter = params[1];
	var results = [];
	if (filter) {
		var tiddlers = store.filterTiddlers(filter);
		for (var t = 0; t < tiddlers.length; t++) results.push(tiddlers[t].title);
	}
	return results;
};

config.macros.allTags.handler = function(place, macroName, params) { // Implements IMacroResolver.handler()
	var tags = store.getTags();
	var ul = createTiddlyElement(place, "ul");
	if (tags.length == 0) createTiddlyElement(ul, "li", null, "listTitle", this.noTags);
	var t;
	for (t = 0; t < tags.length; t++) {
		var title = tags[t][0];
		var classNames = buildClassNames(title);
		var li = createTiddlyElement(ul, "li");
		var btn = renderTiddlyButton(li, title + " (" + tags[t][1] + ")", this.tooltip.format([title]), onClickTag, classNames);
		btn.setAttribute("tag", title);
		btn.setAttribute("refresh", "link");
		btn.setAttribute("tiddlyLink", title);
		if (params[0]) btn.setAttribute("sortby", params[0]);
	}
};

var macro = config.macros.timeline; // HACK

// <<timeline field maxlength dateformat template:title groupTemplate:title filter:filter>>
//
// field         - determines the field used as the basis for the list, usually "modified" or "created"
// maxlength     - an integer that limits the maximum number of tiddlers in the list
// dateformat    - a date format string
// template      - a reference to a tiddler or tiddler section used as the template for list entries
// groupTemplate - a reference to a tiddler or tiddler section used as the template for grouping entries in the list with {{{%0}}} being the name of 
//                 the field that is displayed and {{{%1}}} being a rendered date based on the date format, see parameter "dateformat" above
// filter        - a filter used to filter the tiddlers relevant for the list

merge(macro, {
	handler: function(place, macroName, params, wikifier, paramString, tiddler) {
		var container = jQuery("<div />").attr("params", paramString).attr("macroName", macroName).appendTo(place)[0];
		macro.refresh(container);
	},
	refresh: function(container) {
		jQuery(container).attr("refresh", "macro").empty();
		var paramString = jQuery(container).attr("params");
		var args = paramString.parseParams("anon", null, null)[0];
		var params = args.anon || [];

		var sortBy = params[0] || "modified";
		var prefix = sortBy.charAt(0);
		var no_prefix_field = prefix === "-" || prefix === "+" ? sortBy.substr(1, sortBy.length) : sortBy;
		var dateFormat = params[2] || this.dateFormat;

		var groupTemplate = macro.groupTemplate.format(no_prefix_field, dateFormat);
		groupTemplate = args.groupTemplate ? 
			store.getArticleTextPartOrSlice(args.groupTemplate[0]) || groupTemplate :
			groupTemplate;

		var itemTemplate = macro.itemTemplate;
		itemTemplate = args.template ? store.getArticleTextPartOrSlice(args.template[0]) || itemTemplate :
			itemTemplate;

		var articles = store.getArticlesQuickly(sortBy);

		var lastGroup = "", ul;
		var last = params[1] ? articles.length-Math.min(articles.length, parseInt(params[1], 10)) : 0;
		var i;
		for (i = articles.length - 1; i >= last; i--) { // backwards => most recent on top
			var article = articles[i];
			var theGroup = wikifyPlainText(groupTemplate, 0, article);
			if (typeof(ul) == "undefined" || theGroup != lastGroup) {
				ul = document.createElement("ul");
				jQuery(ul).addClass("timeline");
				container.appendChild(ul);
				createTiddlyElement(ul, "li", null, "listTitle", theGroup);
				lastGroup = theGroup;
			}
			var item = createTiddlyElement(ul, "li", null, "listLink");
			wikify(itemTemplate, item, null, article);
		}
	},
	groupTemplate: "<<view %0 date '%1'>>", 
	itemTemplate: "<<view title link>>"
});

config.macros.tag.handler = function(place, macroName, params) { // Implements IMacroResolver.handler()
	var btn = createTagButton(place, params[0], null, params[1], params[2]);
	if (params[3]) {
		btn.setAttribute('sortby', params[3]);
	}
};

config.macros.tags.handler = function(place, macroName, params, wikifier, paramString, tiddler) { // Implements IMacroResolver.handler()
	params = paramString.parseParams("anon", null, true, false, false);
	var ul = createTiddlyElement(place, "ul");
	var title = getParam(params, "anon", "");
	if (title && store.tiddlerExists(title)) tiddler = store.getArticle(title);
	var sep = getParam(params, "sep", " ");
	var lingo = config.views.wikified.tag;
	var label = null;
	var t;
	for (t = 0; t < tiddler.tags.length; t++) {		
		if (! label) label = createTiddlyElement(ul, "li", null, "listTitle", lingo.labelTags.format([tiddler.title]));
		createTagButton(createTiddlyElement(ul, "li"), tiddler.tags[t], tiddler.title);
		if (t < tiddler.tags.length - 1) createTiddlyText(ul, sep);
	}
	if (! label) createTiddlyElement(ul, "li", null, "listTitle", lingo.labelNoTags.format([tiddler.title]));
};

config.macros.saveChanges.handler = function(place, macroName, params) { // Implements IMacroResolver.handler()
	if (!readOnly)
		renderTiddlyButton(place, params[0] || this.label, params[1] || this.hint, this.onClick, null, null, this.accessKey);
};

config.macros.saveChanges.onClick = function(e) {
	saveChangesAction();
	return false;
};

/**
	* Message macro. Searches the "config" object container for a given message qualifier and renders a span containing the message text.
	*
	* @param  {object[]} params - Accepts only two string parameters. 1st has to be a string like "views.editor.tagHint" - the fully qualified name of the internal message string. 2nd can be a format string.
*/

config.macros.message.handler = function(place, macroName, params) { // Implements IMacroResolver.handler()
	if (! params[0]) {
		return;
	}
	var names = params[0].split(".");
	var lookupMessage = function(haystack, nameIndex) {
		var needle = names[nameIndex];
		var found = haystack[needle];
		if (found) {
			if (nameIndex < names.length - 1)
				return (lookupMessage(found, nameIndex + 1));
			else
				return found;
		} else
			return null;
	};
	var m = lookupMessage(config, 0);
	if (m == null)
		m = lookupMessage(window, 0);
	createTiddlyText(place, m.toString().format(params.splice(1)));
};


config.macros.view.depth = 0;
config.macros.view.values = [];
config.macros.view.views = {
	text: function(value,place,params,wikifier,paramString,tiddler) {
		highlightify(value, place, highlightHack, tiddler);
	},
	link: function(value, place, params, wikifier, paramString, tiddler) {
		renderLinkElement(place, value, true);
	},
	wikified: function(value,place,params,wikifier,paramString,tiddler) {
		if (config.macros.view.depth>50)
			return;
		if (config.macros.view.depth>0) {
			if (value==config.macros.view.values[config.macros.view.depth-1]) {
				return;
			}
		}
		config.macros.view.values[config.macros.view.depth] = value;
		config.macros.view.depth++;
		if (params[2])
			value=params[2].unescapeLineBreaks().format([value]);
		wikify(value, place, highlightHack, tiddler);
		config.macros.view.depth--;
		config.macros.view.values[config.macros.view.depth] = null;
	},
	date: function(value,place,params,wikifier,paramString,tiddler) {
		value = Date.convertFromYYYYMMDDHHMM(value);
		createTiddlyText(place,value.formatString(params[2] || config.views.wikified.dateFormat));
	}
};

config.macros.view.handler = function(place, macroName, params, wikifier, paramString, tiddler) { // Implements IMacroResolver.handler()
	if ((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if (value) {
			var type = params[1] || config.macros.view.defaultView;
			var handler = config.macros.view.views[type];
			if (handler)
				handler(value,place,params,wikifier,paramString,tiddler);
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler) { // Implements IMacroResolver.handler()
	var field = params[0];
	var rows = params[1] || 0;
	var defVal = params[2] || '';
	if ((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		var e,v;
		if (field != "text" && !rows) {
			e = createTiddlyElement(null, "input", null, null, null, {
				type: "text", edit: field, size: "40", autocomplete: "off"
			});
			e.value = store.getValue(tiddler, field) || defVal;
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null, "fieldset", null, "fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1, "div");
			e = createTiddlyElement(wrapper2, "textarea");
			e.value = v = store.getValue(tiddler, field) || defVal;
			rows = rows || 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows, 10), 5);
			if (lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows, maxLines);
			e.setAttribute("rows", rows);
			e.setAttribute("edit", field);
			place.appendChild(wrapper1);
		}
		if (tiddler.isReadOnly()) {
			e.setAttribute("readOnly", "readOnly");
			jQuery(e).addClass("readOnly");
		}
		return e;
	}
};

config.macros.tagChooser.onClick = function(ev) {
	var e = ev || window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags();
	if (tags.length == 0)
		jQuery("<li/>").text(lingo.popupNone).appendTo(popup); // "There are not tags defined"
	var t;
	for (t = 0; t < tags.length; t++) {
		var tag = renderTiddlyButton(createTiddlyElement(popup, "li"), tags[t][0], lingo.tagTooltip.format([tags[t][0]]), config.macros.tagChooser.onTagClick);
		tag.setAttribute("tag", tags[t][0]);
		tag.setArticleTitle(this.getArticleTitle());
	}
	Popup.show();
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return false;
};

/**
	* Event handler after clicking on a tag - will assign the tag to the article.
	*
	* @param  {element} ev - the <a> which represented the tag
*/
config.macros.tagChooser.onTagClick = function(ev) { // (do not mix up with onClickTag)
	var e = ev || window.event;
	if (e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
	var tag = this.getAttribute("tag");
	var title = this.getArticleTitle();
	if (!readOnly)
		story.setTiddlerTag(title, tag, 0);
	return false;
};

config.macros.tagChooser.handler = function(place, macroName, params, wikifier, paramString, tiddler) { // Implements IMacroResolver.handler()
	if (tiddler instanceof Tiddler) {
		var lingo = config.views.editor.tagChooser;
		var btn = renderTiddlyButton(place, lingo.text, lingo.hint, this.onClick);
		btn.setArticleTitle(tiddler.title);
	}
};

config.macros.refreshDisplay.handler = function(place) { // Implements IMacroResolver.handler()
	renderTiddlyButton(place, this.label, this.hint, this.onClick);
};

config.macros.refreshDisplay.onClick = function(e) {
	refreshAll();
	return false;
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place, macroName, params) { // Implements IMacroResolver.handler()
	var tabSetName = params[0];
	var numTabs = (params.length - 1) / 3;
	var wrapper = createTiddlyElement(null, "div", null, "tabsetWrapper " + tabSetName);
	var tabSet = createTiddlyElement(wrapper, "div", null, "tabSet");		
	var t;
	for (t = 0; t < numTabs; t++) {
		var label = params[t * 3 + 1];
		var tooltip = params[t * 3 + 2];
		var content = params[t * 3 + 3];
		var tab = renderTiddlyButton(tabSet, label, tooltip, this.onClickTab, "tab tabUnselected");		
		tab.setAttribute("tab", label);
		tab.setAttribute("content", content);
	}	
	place.appendChild(wrapper);
	this.switchTab(tabSet, params[1]);
};

config.macros.tabs.onClickTab = function(e) {
	config.macros.tabs.switchTab(this.parentNode, this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabSet, tab) {	
	var tabElement = null;
	var nodes = tabSet.childNodes;
	var t;
	for (t = 0; t < nodes.length; t++) {
		if (nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			tabElement = nodes[t];
			tabElement.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if (tabElement) {
		if (tabSet.nextSibling && tabSet.nextSibling.className == "tabContents")
			jQuery(tabSet.nextSibling).remove();
		var tabContent = createTiddlyElement(null, "div", null, "tabContents");
		tabSet.parentNode.insertBefore(tabContent, tabSet.nextSibling);
		var contentTitle = tabElement.getAttribute("content");
		wikify(store.getArticleTextPartOrSlice(contentTitle), tabContent, null, store.getArticle(contentTitle));		
	}
};

//--
//-- Menu and toolbar commands
//--

config.commands.permalink.handler = function(event, src, title) { // Implements ICommand.handler()
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if (window.location.hash != t) window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup, title) {
	var references = store.getReferringTiddlers(title);
	var c = false;
	var r;
	for (r = 0; r < references.length; r++) {
		if (references[r].title != title) {
			renderLinkElement(createTiddlyElement(popup, "li"), references[r].title, true);
			c = true;
		}
	}
	if (!c) createTiddlyElement(popup, "li", null, "disabled", this.popupNone);
};

config.commands.jump.handlePopup = function(popup, title) {
	story.forEachArticleView(function(title, element) {
		renderLinkElement(createTiddlyElement(popup, "li"), title, true, null, false, null, true);
	});
};

config.commands.fields.handlePopup = function(popup,title) {
	var tiddler = store.getArticle(title);
	if (!tiddler)	return;
	var items = [];
	store.forEachField(tiddler, function(tiddler,fieldName,value) {items.push({field:fieldName,value:value});},true);
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if (items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup, "div", null, null, this.emptyText);
};

//--
//-- Filter a list of tiddlers
//--

config.filters = {
	tiddler: function(results, match) {
		var title = match[1] || match[4];
		var tiddler = this.getArticle(title);
		if (tiddler) {
			results.pushUnique(tiddler);
		} else if (isShadowTiddler(title)) {
			tiddler = new Tiddler();
			tiddler.set(title, this.getArticleTextPartOrSlice(title));
			results.pushUnique(tiddler);
		} else {
			results.pushUnique(new Tiddler(title));
		}
		return results;
	},
	tag: function(results, match) {
		var matched = this.getArticlesByTag(match[3]);
		for (var m=0; m < matched.length; m++) {
			results.pushUnique(matched[m]);
		}
		return results;
	},
	sort: function(results, match) {
		return this.sortTiddlers(results, match[3]);
	},
	limit: function(results, match) {
		return results.slice(0, parseInt(match[3], 10));
	},
	field: function(results, match) {
		var matched = this.getArticlesByField(match[2], true, match[3]);
		var m;
		for (m = 0; m < matched.length; m++) {
			results.pushUnique(matched[m]);
		}
		return results;
	}
};

function StringFieldAccess(n, readOnly) {
	this.set = readOnly ?
		function(t,v) {if (v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
		function(t,v) {if (v != t[n]) {t[n] = v; return true;}};		
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n) {
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if (d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n) {
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if (s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.buildInternalLinksTuple(t[n]);};
}

ArticleStore.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"creator":  new StringFieldAccess("creator"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

ArticleStore.isStandardField = function(name) {
	return ArticleStore.standardFieldAccess[name] != undefined;
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
ArticleStore.prototype.getValue = function(tiddler, fieldName) {
	var t = this.resolveTiddler(tiddler);
	if (!t)
		return undefined;
	if (fieldName.indexOf(config.textPrimitives.sectionSeparator) === 0 || fieldName.indexOf(config.textPrimitives.sliceSeparator) === 0) {
		var sliceType = fieldName.substr(0, 2);
		var sliceName = fieldName.substring(2);
		return store.getArticleTextPartOrSlice("%0%1%2".format(t.title,sliceType,sliceName));
	} else {
		fieldName = fieldName.toLowerCase();
		var accessor = ArticleStore.standardFieldAccess[fieldName];
		if (accessor) {
			return accessor.get(t);
		}
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
ArticleStore.prototype.forEachField = function(articleOrTitle, callback, onlyExtendedFields, sortExtendedFields) { // HACK: Das sollte am Article kleben und nicht am Store
	var t = this.resolveTiddler(articleOrTitle);
	if (! t) return undefined;
	var result;
		
	// We want to sort the extended fields because they will be externalized when saving.
	// If sorted randomly, we would produce unnecessary changes in the saved file which would pop up in any diff viewer.
	var keys = Object.keys(t.fields); // JavaScript cannot sort t.fields hashtable directly. We rip the keys array and sort that.
	keys.sort();

	for (var i = 0; i < keys.length; i++) {
		result = callback(t, keys[i], t.fields[keys[i]]);
		if (result)	return result;
	}

	if (onlyExtendedFields) return undefined;
	
	for (var n in ArticleStore.standardFieldAccess) {
		if (n != "tiddler") {
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			result = callback(t, n, ArticleStore.standardFieldAccess[n].get(t));
			if (result)	return result;
		}
	}
	return undefined;
};

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
	{name: "SystemSettings", notify: onSystemSettingsChange},
	{name: "PageTemplate", notify: refreshPageTemplate},	
	{name: null, notify: refreshDisplay}
];

config.refreshers = {
	link: function(e, changeList) {
		var title = e.getAttribute("tiddlyLink");
		var classNames = buildClassNames(title, e.className);
		e.className = classNames;
		return true;
	},

	tiddler: function(e, changeList)	{
		var title = e.getArticleTitle();
		var templateNameOrNumber = e.getAttribute("template");
		if (changeList && (changeList.indexOf && changeList.indexOf(title) != -1) && ! story.isDirty(title))
			story.populateViewOrChangeTemplate(title, templateNameOrNumber, true);
		else
			refreshElements(e, changeList);
		return true;
	},

	content: function(e, changeList)	{
		var title = e.getArticleTitle();
		var force = e.getAttribute("force");
		var args = e.getAttribute("args");
		if (force != null || changeList == null || (changeList.indexOf && changeList.indexOf(title) != -1)) {
			jQuery(e).empty();
			config.macros.transclude.transclude(e,title,args);
			return true;
		} else
			return false;
	},

	macro: function(e, changeList)	{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if (macro)
			macro = config.macros[macro];
		if (macro && macro.refresh)
			macro.refresh(e, params);
		return true;
	}
};

config.refresherData = {
	pageTemplate: "PageTemplate",
	defaultPageTemplate: "PageTemplate"
};

function refreshElements(root, changeList) {
	var nodes = root.childNodes;
	for (var i = 0; i < nodes.length; i++) {
		var e = nodes[i], type = null;
		if (e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true)) type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if (refresher != undefined) refreshed = refresher(e, changeList);
		if (e.hasChildNodes() && ! refreshed) refreshElements(e, changeList); // recursion!
	}
}

// scans html code for elements with macro attributes and executes the macros. E.g. <span macro="version"></span>
function applyHtmlMacros(root, tiddler) {
	var e = root.firstChild;
	while (e) {
		var nextChild = e.nextSibling;
		if (e.getAttribute) {
			var macro = e.getAttribute("macro");
			if (macro) {
				e.removeAttribute("macro");
				var params = "";
				var p = macro.indexOf(" ");
				if (p != -1) {
					params = macro.substr(p + 1);
					macro = macro.substr(0, p);
				}
				invokeMacro(e, macro, params, null, tiddler);
			}
		}
		if (e.hasChildNodes()) applyHtmlMacros(e, tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title) {
	var stash = jQuery("<div/>").appendTo("body").hide()[0];
	var display = story.getArticleWrapper();
	var nodes;
	if (display) {
		nodes = display.childNodes;
		for (var t = nodes.length - 1; t >= 0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");

	if (!title || !store.isAvailable(title))
		title = config.refresherData.pageTemplate;
	if (!store.isAvailable(title))
		title = config.refresherData.defaultPageTemplate; //# this one is always avaialable
	wrapper.innerHTML = store.getArticleRawTextResolveIncludes(title, null, 10);
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = story.getArticleWrapper();
	jQuery(display).empty();
	if (!display)
		display = createTiddlyElement(wrapper, "div", story.articleWrapperId);
	nodes = stash.childNodes;
	for (var t = nodes.length - 1; t >= 0; t--)
		display.appendChild(nodes[t]);
	jQuery(stash).remove();
}

function refreshDisplay(hint) { // hint dürfte immer undefined sein!
	if (typeof hint == "string") hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e, hint);
	if (backstage.isPanelVisible()) {
		refreshElements(backstage.panel, hint);
	}
}

function getPageTitle() { // document.title = getPageTitle();
	return wikifyPlainText(config.options.txtWikiTitle, null, null);	
}

function refreshAll() {
	refreshPageTemplate();
	refreshDisplay();
}

//--
//-- Option handling
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name, value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? 'true' : 'false';},
		set: function(name, value) {config.options[name] = value == 'true';}
	}
};

function setOption(name, value) {
	var optType = name.substr(0,3);
	if (config.optionHandlers[optType] && config.optionHandlers[optType].set)
		config.optionHandlers[optType].set(name,value);
}

// Gets the value of an option as a string. Most code should just read from config.options.* directly
function getOption(name) {
	var optType = name.substr(0, 3);
	return config.optionHandlers[optType] && config.optionHandlers[optType].get ? config.optionHandlers[optType].get(name) : null;
}

function loadOptions() {
	if (safeMode) return;
	loadSystemSettings();
}

function loadSystemSettings() {
	var settings = store.calcAllSlices('SystemSettings');
	config.optionsSource = {};
	for (var key in settings) {
		setOption(key,settings[key]);
		config.optionsSource[key] = 'setting';
	}
}

function onSystemSettingsChange() {
	if (! startingUp) {
		loadSystemSettings();
	}
	document.title = getPageTitle();
}

function saveOption(name) {
	
	if (safeMode) return;
	
	if (name.match(/[()\s]/g, '_')) {
		alert(config.messages.invalidCookie.format([name]));
		return;
	}
		
	if (config.optionsSource[name] == 'setting') {
		saveSystemSetting(name, true);
	}
}

var systemSettingSave;

function commitSystemSettings(storeWasDirty) {
	if (systemSettingSave) window.clearTimeout(systemSettingSave);
	systemSettingSave = window.setTimeout(function() {autoSaveChanges();}, 1000);
}

function saveSystemSetting(name, doSaveFile) {
	var title = 'SystemSettings';
	var slice = store.getTiddlerSlice(title,name);
	if (readOnly || slice === getOption(name)) {
		return; //# don't save if read-only or the option hasn't changed
	}
	var slices = store.calcAllSlices(title);
	var key;
	for (key in config.optionsSource) {
		var value = getOption(key) || '';
		if (slices[key] !== value) {
			slices[key] = value;
		}
	}
	var text = [];
	for (key in slices) {
		text.push('%0: %1'.format([key, slices[key]]));
	}
	text = text.sort().join('\n');
	var storeWasDirty = store.isDirty();
	var tiddler = store.getArticle(title);
	if (tiddler) {
		tiddler.text = text;
		tiddler = store.addOrUpdate(tiddler);
	} else {
		tiddler = store.addOrUpdate(title, title, text, 'System', new Date(), null, null);
	}
	if (doSaveFile) {
		commitSystemSettings(storeWasDirty);
	}
}

function encodeCookie(s) {
	return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s) {
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,'')));});
}

// Vodi

config.macros.anchor = {};

config.macros.anchor.handler = function(place, macroName, params) { // Implements IMacroResolver.handler()
	var e =	createTiddlyElement(place, "a");
	e.name = params[0];
	e.text = params[1];
	e.className = "anchor";
};

config.macros.navigate = {};

config.macros.navigate.handler = function(place, macroName, params) { // Implements IMacroResolver.handler()
	renderTiddlyButton(place, '←', "Navigate Backwards", function() {config.commands.navigateBack.handler();},	null, null, null);
	renderTiddlyButton(place, '→', "Navigate Foward", function() {config.commands.navigateForward.handler();},	null, null, null);
};

config.macros.newArticleButton = {};

// This will render the button
config.macros.newArticleButton.handler = function(place, macroName, params) { // Implements IMacroResolver.handler()
	// process command line parameters
	var label = params[0];
	var createRoot = params[1];
	if (createRoot == "true") {
		renderTiddlyButton(place, label, "Create a new root level page", function() {config.macros.newArticleButton.onClick(true);},	null, null, null);
	} else{
		renderTiddlyButton(place, label, "Create a sub page for the current page", function() {config.macros.newArticleButton.onClick(false);},	null, null, null);
	}
};

config.macros.newArticleButton.onClick = function(createRoot) {
	var parentTitle = store.currentTiddler ? store.currentTiddler.title : null;
	if (createRoot || ! parentTitle || parentTitle == "Untitled")	parentTitle = "";
	story.showArticle("Untitled", DEFAULT_EDIT_TEMPLATE, parentTitle ? "parenttitle:[[" + parentTitle + "]]" : null);
	story.focusTiddler("Untitled", "title");
};

config.macros.sectionTOC = { // todo: this only works when the user positions the macro at the end of the article - this should be fixed.
	targetClass: 'sectionTOC',
	linkFormat: '[[%0|##%0]]',
	handler: function(place,macroName,params, wikifier, paramString,tiddler) {
		var out = [];
		var targetClass = params[0]||this.targetClass;
		var t = story.getArticleViewByChild(place);
		if (! t) return;
		var elems = t.getElementsByTagName('*');
		var level = 5; // topmost heading level
		for (var i = 0; i < elems.length; i++) {
			var txt = getPlainText(elems[i]).trim();
			var link = this.linkFormat.format([txt]);
			switch (elems[i].nodeName) {
				case 'H1': out.push('#'+link);		level = 1; break;
				case 'H2': out.push('##'+link);		level = level < 2 ? level : 2; break;
				case 'H3': out.push('###'+link);	level = level < 3 ? level : 3; break;
				case 'H4': out.push('####'+link);	level = level < 4 ? level : 4; break;
				case 'H5': out.push('#####'+link); level = level < 5 ? level : 5; break;
				default: if (hasClass(elems[i], targetClass)) var target = elems[i]; // search for element with 'sectionTOC' class like {{sectionTOC{}}}
			}
		}
		// trim excess bullet levels
		if (level > 1) for (var i = 0; i < out.length; i++) out[i] = out[i].substr(level - 1);
		// show numbered list
		if (out.length && target) {
			if (target.style.display == 'none') target.style.display = 'block';
			wikify(out.join('\n'), target);
		}
	}
}

// Zähle, der wievielte Treffer das Wort needle im DOM ist, wenn man bis zum Anker (=selektierter Node) navigiert.
function recurseViewer(node, anchor, needle) {
	for (var i = 0; i < node.childNodes.length; i++) {
		var child = node.childNodes[i];
		if (child.nodeType == Node.TEXT_NODE) {
		  if (child.nodeValue.indexOf(needle) >= 0) {
				recurseViewerOccurance++;
				if (child == anchor) {
					return false;
				}
			}
		}
		var cont = recurseViewer(child, anchor, needle);
		if (! cont) {
			return false;
		}	
	}
	return true;
}

function highlightArticleTree() {
	if (typeof _PreviousCurrentArticleTreeElement !== 'undefined') _PreviousCurrentArticleTreeElement.classList.remove('current');

	if (! store.currentTiddler) return; // todo: current darf nicht im store leben, sondern nur in story!

	var articleTreePanel = document.getElementsByClassName('articleTreePanel')[0];
	var nodeElement = document.querySelector('[tiddlylink="' + store.currentTiddler.title + '"]');
	
	if (! articleTreePanel || ! nodeElement) return;
	
	nodeElement.classList.add('current');	 

	_PreviousCurrentArticleTreeElement = nodeElement;

	var container = articleTreePanel.parentNode;	

	var offsetToContainer = calcOffsetTo(nodeElement, container);

	if (offsetToContainer < container.scrollTop) container.scrollTop =  Math.max(0, offsetToContainer - nodeElement.offsetHeight);

	var visibleBottom = container.scrollTop + container.clientHeight;
	var elementBottom = offsetToContainer + nodeElement.offsetHeight;

	if (elementBottom > visibleBottom) {
		container.scrollTop =  elementBottom - container.clientHeight + nodeElement.offsetHeight;
	}		 
}

function calcOffsetTo(inner, outer) {
	var curtop = 0;
	while (inner.offsetParent) {		
		curtop += inner.offsetTop;
		if (inner.offsetParent == outer) break;
		inner = inner.offsetParent;		
	}
	return curtop;
}

config.commands.navigateBack = {
	text: 'Back',
	tooltip: 'View the previous page.',
	handler: function(event, src, title) { // Implements ICommand.handler()
		story.history.back();
		return false;
	}
};

config.commands.navigateForward = {
	text: 'Forward',
	tooltip: 'View the previous page.',
	handler: function(event, src, title) { // Implements ICommand.handler()
		story.history.forward();
		return false;
	}
};

//--
//-- Saving
//--

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit() {
	hadConfirmExit = true;
	if ((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges() {
	if (store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if (confirm(config.messages.unsavedChangesWarning))	saveChangesAction();
	}
}

function autoSaveChanges() {
	if (config.options.chkAutoSave) saveChangesAction();
}

function getHtmlSourceWithoutDynamicallyAddedContent() {
	var content = window.originalHTML || recreateOriginal();
	return content;
}

function createEmptyWikiAction() {
	
	var originalPath = document.location.toString();
	var localPath = getLocalPath(originalPath);
	
	var emptyPath, p;
	if ((p = localPath.lastIndexOf("/")) != -1)
		emptyPath = localPath.substr(0,p) + "/";
	else if ((p = localPath.lastIndexOf("\\")) != -1)
		emptyPath = localPath.substr(0,p) + "\\";
	else
		emptyPath = localPath + ".";
	
	emptyPath += "New Wiki.html";
	
	var original = window.originalHTML;
	var storeAreaRange = locateStoreArea(original);
	var empty = original.substr(0, storeAreaRange[0] + storeAreaStartString.length) + original.substr(storeAreaRange[1]);
	
	var emptySave = saveFile(emptyPath, empty);
			
	if (emptySave){
		emptyPath = "file:///" + emptyPath;
		displayMessage(config.messages.emptySaved, emptyPath, -1);
	} else {
		alert(config.messages.emptyFailed);
	}
}

function buildClassNames(title, additionalClassNames) {
	var classes = additionalClassNames ? additionalClassNames.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.getArticle(title);
	if (tiddler) {
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if (isShadowTiddler(title)) {
			classes.pushUnique("shadow");
		} else {
			classes.remove("shadow");
		}
	}	
	return classes.join(" ");
}

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue) {
	if (!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue) {
	return !!getParam(params,name,defaultValue);
}

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r, g, b) {
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if (typeof r == "string") {
		if (r.substr(0,1) == "#") {
			if (r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if (c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f) {
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function() {
	var clamp = function(x, min, max) {
		return x < min ? min : (x > max ? max : x);
	};
	return "#" +
			("0" + Math.floor(clamp(this.r,0,1) * 255).toString(16)).right(2) +
			("0" + Math.floor(clamp(this.g,0,1) * 255).toString(16)).right(2) +
			("0" + Math.floor(clamp(this.b,0,1) * 255).toString(16)).right(2);
};

//]]>
</script>
<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
//--
//-- Deprecated Crypto functions and associated conversion routines.
//-- Use the jQuery.encoding functions directly instead.
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str) {
	return jQuery.encoding.strToBe32s(str);
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be) {
	return jQuery.encoding.be32sToStr(be);
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be) {
	return jQuery.encoding.be32sToHex(be);
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str) {
	return jQuery.encoding.digests.hexSha1Str(str);
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str) {
	return jQuery.encoding.digests.sha1Str(str);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x, blen) {
	return jQuery.encoding.digests.sha1(x, blen);
};

//--
//-- Deprecated code
//--

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item) {
	var i = this.indexOf(item);
	return i == -1 ? null : i;
};

//--
//-- Deprecated utility functions
//-- Use the jQuery functions directly instead
//--

// Return the content of an element as plain text with no formatting
function getPlainText(e) {
	return jQuery(e).text();
}

function addClass(e,className) {
	jQuery(e).addClass(className);
}

function removeClass(e,className) {
	jQuery(e).removeClass(className);
}

function hasClass(e,className) {
	return jQuery(e).hasClass(className);
}

//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
/*
jQuery.encoding.digests.sha1.js

SHA-1 digest and associated utility functions

Copyright (c) UnaMesa Association 2009

Dual licensed under the MIT and GPL licenses:
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

if (!$.encoding)
	$.encoding = {};
	$.extend($.encoding,{
		strToBe32s: function(str) {
			// Convert a string to an array of big-endian 32-bit words
			var be=[];
			var len=Math.floor(str.length/4);
			var i, j;
			for (i=0, j=0; i<len; i++, j+=4) {
				be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
			}
			while (j<str.length) {
				be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
				j++;
			}
			return be;
		},
		be32sToStr: function(be) {
			// Convert an array of big-endian 32-bit words to a string
			var str='';
			for (var i=0;i<be.length*32;i+=8) {
				str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
			}
			return str;
		},
		be32sToHex: function(be) {
			// Convert an array of big-endian 32-bit words to a hex string
			var hex='0123456789ABCDEF';
			var str='';
			for (var i = 0; i < be.length * 4; i++) {
				str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
			}
			return str;
		}
	});
})(jQuery);


(function($) {

if (!$.encoding.digests)
	$.encoding.digests = {};
	$.extend($.encoding.digests,{
		hexSha1Str: function(str) {
			// Return, in hex, the SHA-1 hash of a string
			return $.encoding.be32sToHex($.encoding.digests.sha1Str(str));
		},
		sha1Str: function(str) {
			// Return the SHA-1 hash of a string
			return sha1($.encoding.strToBe32s(str),str.length);
		},
		sha1: function(x,blen) {
			// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
			return sha1($.encoding.strToBe32s(str),str.length);
		}
	});

	// Private functions.
	function sha1(x,blen) {
		// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
		function add32(a,b) {
			// Add 32-bit integers, wrapping at 32 bits
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			var lsw=(a&0xFFFF)+(b&0xFFFF);
			var msw=(a>>16)+(b>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function AA(a,b,c,d,e) {
			// Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			b=(b>>>27)|(b<<5);
			var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
			var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function RR(w,j) {
			// Cryptographic round helper function.
			var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
			return (n>>>31)|(n<<1);
		}

		var len=blen*8;
		x[len>>5] |= 0x80 << (24-len%32);
		x[((len+64>>9)<<4)+15]=len;
		var w=new Array(80);

		var k1=0x5A827999;
		var k2=0x6ED9EBA1;
		var k3=0x8F1BBCDC;
		var k4=0xCA62C1D6;

		var h0=0x67452301;
		var h1=0xEFCDAB89;
		var h2=0x98BADCFE;
		var h3=0x10325476;
		var h4=0xC3D2E1F0;

		for (var i=0;i<x.length;i+=16) {
			var j=0;
			var t;
			var a=h0;
			var b=h1;
			var c=h2;
			var d=h3;
			var e=h4;
			while (j<16) {
				w[j]=x[i+j];
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while (j<20) {
				w[j]=RR(w,j);
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while (j<40) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k2);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while (j<60) {
				w[j]=RR(w,j);
				t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while (j<80) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k4);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			h0=add32(h0,a);
			h1=add32(h1,b);
			h2=add32(h2,c);
			h3=add32(h3,d);
			h4=add32(h4,e);
		}
		return [h0,h1,h2,h3,h4];
	}
})(jQuery);
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
